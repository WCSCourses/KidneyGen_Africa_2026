# Training Exercise: Post-GWAS Analysis
see [pdf version](fuma_excercice.pdf)
## Post-GWAS Analysis – Context

Post-GWAS analysis refers to the set of analyses performed **after a genome-wide association study (GWAS)** to interpret and translate GWAS signals into biological insights.

Post-GWAS analyses aim to **extract, understand, and interpret association results at multiple levels**, including significant genomic regions, variants, and gene-based analyses. These analyses most often rely on **GWAS summary statistics**, **linkage disequilibrium (LD) information**, and/or **genotype data**, combined with external biological databases and various software.

## Examples of Post-GWAS Analyses  
*(non-exhaustive list)*

- Assessment of association quality and potential bias using genomic inflation factors (λ), QQ plots, and Manhattan plots  
- Extraction of significant SNPs and fine-mapping to identify one or more putative causal variants  
- Visualization and annotation of SNPs to characterize their functional impact and validate implicated variants  
- Replication of previously reported associations and validation of new results using independent or published datasets  
- Gene-based and gene-set association analyses  
- Variant-to-gene mapping using eQTLs and chromatin interaction data  
- Functional annotation of variants (e.g. regulatory effects, coding consequences)  
- Pathway and gene-set enrichment analyses  
- Tissue- or cell-type specificity analyses  

* More extensive (non-exhaustive) list
 - Construction and validation of polygenic risk scores (PRS)  
 - Mendelian randomization  
 - Multi-omics approaches (e.g. transcriptomics, epigenomics, proteomics)


## Software, Platforms, and Technical Approaches

Post-GWAS analyses rely on a wide range of **software tools, databases, and analytical approaches**. Depending on the research question, available resources, and technical expertise, researchers may adopt different strategies, each with its own advantages and limitations. Below are some commonly used approaches, with representative tools.

### 1. Manual analysis

The analyst performs all analyses step by step using individual software tools.  
This approach is **highly flexible and transparent**, but **time-consuming**, requires substantial computational resources, and carries a higher risk of human error.

**Commonly used tools:**
- **PLINK** – SNP filtering, clumping, basic association summaries  
- **GCTA** – conditional analysis, heritability estimation  
- **LocusZoom** – regional association plots  
- **FINEMAP**, **SuSiE**, **CAVIAR** – fine-mapping of causal variants  
- **ANNOVAR**, **VEP** – functional annotation of variants  
- **MAGMA** – gene-based and gene-set association analysis  
- **R / Python** – custom visualization, statistics, and integration

---

### 2. Pipelines and workflows (local or server-based)

Analyses are performed using automated pipelines deployed on local machines, HPC clusters, or cloud servers.  
This approach is **more reproducible and scalable** once set up, but requires computational infrastructure and maintenance. It is generally less flexible than fully manual analyses, although it allows the use of **custom reference datasets**, such as population-specific LD panels.

**Commonly used pipelines and frameworks:**
- **H3AGWAS pipeline** – GWAS and post-GWAS workflows tailored for African genomics  

---

### 3. Web-based platforms and interfaces

Analyses are performed using online tools that provide **predefined pipelines and parameter settings**.  
These platforms are **very user-friendly** and require minimal computational resources, but are often **less flexible**, for example when users cannot supply their own LD reference panels or raw genotype data.

**Commonly used web-based tools:**
- **FUMA** – functional mapping, annotation, and gene prioritization  


##  Annotation Using FUMA

### FUMA – General description

Functional Mapping and Annotation of Genome-Wide Association Studies (FUMA) is a web-based platform used to annotate, prioritize, visualize, and interpret GWAS results.  
FUMA is organized into three main modules:

- **SNP2GENE**  
  Takes GWAS summary statistics as input and provides extensive functional annotation for SNPs located in genomic regions defined by lead SNPs.

- **GENE2FUNC**  
  Takes a list of gene IDs (identified by SNP2GENE or provided manually) and annotates genes in their biological context, including tissue expression and pathway enrichment.

- **Cell Type**  
  Uses gene-level association results from MAGMA (generated by SNP2GENE or provided manually) to identify relevant cell types.

To submit your own GWAS data, user registration and login are required for security reasons.  
Public results (including example jobs) can be explored via the “Browse Public Results” section without registration.

FUMA is frequently updated and widely used by the GWAS community.

- **Tutorial:** https://fuma.ctglab.nl/tutorial#magma

---

## SNP2GENE

The **SNP2GENE** module performs multiple analyses and visualizations based on GWAS summary statistics.  
It uses linkage disequilibrium (LD) information and PLINK-based clumping to identify significant and independent SNPs, perform functional annotation, and conduct MAGMA gene-based analyses.

---

## Significant SNPs and Annotation

### Definition of Lead, Independent, and Candidate SNPs in FUMA

FUMA provides several definitions to describe regional GWAS signals by combining **P-values**, **LD structure**, and **physical distance**, with the aim of prioritizing putative causal variants and genes.

#### 1. Independent Significant SNPs (Ind. sig. SNPs)

Independent significant SNPs are defined as SNPs that:
- Have a P-value ≤ a user-defined genome-wide significance threshold (default: 5 × 10⁻⁸)
- Are independent from each other at a user-defined LD threshold (r² ≤ 0.6 by default)

These SNPs are equivalent to GWAS SNPs retained after PLINK clumping using the same P-value and r² thresholds.  
Independent significant SNPs are used to identify **candidate SNPs** that are in LD with them and are subsequently used for gene prioritization.

Relaxing the genome-wide significance threshold increases the Gnumber of independent significant SNPs. This can be useful when exploring loci that do not reach the conventional significance level.  
Alternatively, users may provide predefined lead SNPs, which will be treated as independent significant SNPs regardless of their P-values.

Increasing the r² threshold results in:
- More SNPs classified as independent significant SNPs
- Fewer candidate SNPs in LD with each independent signal

---

#### 2. Lead SNPs

Lead SNPs are a subset of independent significant SNPs that are:
- Independent from each other at a stricter LD threshold (r² < 0.1 by default; user-defined from v1.3.5)

Lead SNPs represent the most independent signals across the genome and are analogous to clumping independent SNPs at r² = 0.1 using PLINK.

If r² is set to 0.1 for independent SNPs, lead SNPs and independent significant SNPs become identical.  
However, this may increase the number of candidate SNPs in LD with each signal. For this reason, FUMA generally recommends using a higher r² threshold (e.g. 0.6) when defining independent significant SNPs.

---

#### 3. Genomic Risk Loci

FUMA further groups lead SNPs into **genomic risk loci**, which represent broader regions containing one or more independent association signals.

The procedure is as follows:
1. Independent significant SNPs that are in LD with each other at r² ≥ 0.1 are assigned to the same locus.
2. Loci that are physically close (within a user-defined distance; default: 250 kb) are merged.
3. Each genomic risk locus is represented by the lead SNP with the smallest P-value in that region.

The distance between loci is calculated based on the closest SNPs in LD with each independent significant SNP.

---

#### 4. Candidate SNPs

Candidate SNPs are defined as SNPs that:
- Are in LD with at least one independent significant SNP at the user-defined r² threshold
- Pass an optional P-value threshold for GWAS-tagged SNPs (default: P ≤ 0.05)

Candidate SNPs, together with independent significant SNPs, are fully annotated in FUMA and used for gene prioritization.  
All candidate SNPs are listed in the **“SNPs”** results table, including their predicted functional consequences.

Not all candidate SNPs are necessarily in LD with lead SNPs, but they must be in LD with independent significant SNPs.

Increasing the r² threshold reduces the number of candidate SNPs.  
When using a lower r² threshold (e.g. < 0.6), it may be necessary to apply a more stringent P-value threshold for GWAS-tagged SNPs to avoid including weakly associated variants.

---

## Interpretation and Limitations

The distinctions between independent significant SNPs, lead SNPs, candidate SNPs, and genomic risk loci rely on **LD-based approximations**.  
Candidate SNPs can be viewed as a **putative credible set** of variants that may contain the causal variant(s). Importantly, **lead SNPs are not necessarily causal variants**.

A limitation of LD-based locus definition is that merging independent signals into a single locus may obscure distinct association signals.

More advanced approaches, such as **Bayesian fine-mapping**, explicitly model LD structure to identify one or more causal variants and define **credible sets** with higher precision.

## Annotation

FUMA provides several annotation tables based on **candidate SNPs**, defined as SNPs that are in linkage disequilibrium (LD) with at least one independent significant SNP. Depending on the selected mapping strategies, not all candidate SNPs are necessarily mapped to genes.

- **SNPs annotation**  
  Contains all candidate SNPs (i.e. SNPs in LD with independent significant SNPs), together with functional annotations.  
  Note that, depending on the mapping criteria used, not all candidate SNPs listed in this table are mapped to genes.

- **ANNOVAR**  
  Provides ANNOVAR-based functional annotations for all candidate SNPs in **SNPs annotation** , including predicted functional consequences (e.g. exonic, intronic, intergenic).

- **Mapped genes**  
  Lists genes mapped by candidate SNPs (**SNPs annotation**) based on user-defined mapping strategies.  
  Columns labeled *posMap*, *eQTLMap*, or *ciMap* are shown only when positional mapping, eQTL mapping, or chromatin interaction mapping is performed, respectively.  
  These columns report the number of candidate SNPs mapped to each gene, together with additional annotations.

- **eQTL mapping**  
  Displayed only when eQTL mapping is enabled.  
  This table contains unique **SNP–gene–tissue** combinations; therefore, the same SNP may appear multiple times if it is associated with multiple genes or tissues.

- **GWAS Catalog**  
  Lists SNPs reported in the GWAS Catalog that overlap with candidate SNPs (in **SNPs annotation**) from the uploaded GWAS summary statistics.

---

## Gene-Based Analysis: MAGMA

FUMA performs **MAGMA gene analysis**, **gene-set analysis**, and **gene-property analysis**.  
In this section, details of the **reference panels** and **gene expression datasets** used for these analyses are provided.

Gene-based analysis is pe1rformed using **default MAGMA parameters** (SNP-wise mean model) and the user-selected reference panel. SNPs are assigned to genes based on physical position, and gene-level association statistics are computed using SNP-level P-values within each gene region.

MAGMA identifies significant genes by aggregating association signals across SNPs located within or near genes.

---

## Plots and Manhattan Plots

### Genome-Wide Plots

Genome-wide plots are generated from GWAS summary statistics.  
For visualization purposes, overlapping data points are filtered according to the following criteria:

- **Manhattan plot**  
  Overlapping SNPs are filtered such that only one data point is shown per pixel when the average number of data points per pixel (along the x-axis) across the y-axis exceeds 1.  
  For each pixel, a SNP is randomly selected for plotting.  
  SNPs with P-values ≥ 1 × 10⁻⁵ are excluded from the plot.

---

### Plots for Gene-Based Tests (MAGMA)

Gene-based plots are generated using MAGMA (v1.10) with default settings.  
SNPs are assigned to genes based on **Ensembl build 85**, considering **protein-coding genes only**.

These plots visualize gene-level association results across the genome.

---

## Regional Plots

Regional association plots can be generated based on:
- Independent significant SNPs  
- Lead SNPs  
- Genomic risk loci  

Optional annotations (e.g. genes, recombination rates, functional elements) can be included to facilitate interpretation.

Alternative tools for generating regional association plots include:
- **LocusZoom v2**: http://locuszoom.org/  
- R packages for regional association visualization (see `https://github.com/jeantristanb/kidneygenafrica_course_january_2026/blob/main/excercice_gwas/post_association.md`)


---

## Exercise

### Dataset Description

The dataset includes approximately **67,000 African American individuals** and represents one of the largest GWAS datasets available for individuals of African ancestry.
The data were generated from a **meta-analysis of eight cohorts** using the METAL software and have been uploaded to the FUMA platform.

More information and data access:
https://susztaklab.com/GWAS2M/Download.php

This dataset was developed to support the **Kidney Disease Genetic Scorecard**, a framework that integrates **32 different data types** to prioritize causal genetic variants and genes involved in kidney disease.

Reference publication:
https://www.science.org/doi/10.1126/science.adp4753

---


### FUMA and Parameters

Tutorial:
https://fuma.ctglab.nl/tutorial

**Parameters used:**

- **Reference genotype panel:** African populations from the 1000 Genomes Project
- **LD threshold:** r² > 0.6
- **Minor allele frequency (MAF):** > 0.01
- **eQTL mapping:** Enabled using most available eQTL databases
- **MAGMA analysis:** Performed for gene-based and downstream analyses


Click on the link below to explore the eGFR GWAS results from Liu et al. in FUMA:

https://fuma.ctglab.nl/browse/697303

---

### Identification of lead SNPs

- Identify lead SNPs and genomic risk loci using a genome-wide significance threshold of **5 × 10⁻⁸**.
- How many putative genomic risk loci are identified?
- Using regional plots and SNPs in linkage disequilibrium (LD), how is each lead SNP supported by neighboring SNPs?
- What differences do you observe between lead SNPs across loci (e.g. effect size, LD structure, number of supporting SNPs)?

---

### Annotation of lead SNPs

- Which SNPs and genomic regions have been previously reported in GWAS?
  - Can you assess the novelty of each locus using previous association ?
  - What are the limitations of this approach?
  - What additional analyses or external resources would you use to confirm novelty?
- Using pathogenicity scores (e.g. CADD) and functional annotations:
  - Which SNPs are predicted to be potentially pathogenic and in what genes?

---

### MAGMA Results

- Which genes are identified as significant in the MAGMA gene-based analysis?
- Which of these genes have been well described in previous studies?
- What are the differences between locus-based (SNP-level) annotation and MAGMA gene-based results?
- Which results are shared between the two approaches, and how would you interpret any discrepancies?

---

### African Context

- What do you think about using a genome-wide significance threshold of **5 × 10⁻⁸** in an African-ancestry GWAS?
- Is this threshold appropriate given the higher genetic diversity and shorter LD blocks in African populations?
- How should significance thresholds be handled in **trans-ethnic or multi-ancestry GWAS**?
- What alternative strategies could be considered (e.g. ancestry-specific thresholds, empirical thresholds, replication-based validation)?

